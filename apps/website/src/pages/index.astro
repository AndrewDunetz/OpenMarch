---
import Layout from "@/layouts/Layout.astro";
import { Button } from "@openmarch/ui";
import { getCollection, type CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import FeatureSelector from "@/components/home/FeatureSelector";
import { CURRENT_VERSION } from "@/constants";
import NewsletterForm from "@/components/ui/NewsletterForm";

const blogs = await getCollection("blog");
type Blog = CollectionEntry<"blog">;
---

<Layout title="Home">
    <script>
        import { Observer } from "tailwindcss-intersect";

        Observer.start();
    </script>
    <section
        id="landing"
        class="relative flex h-fit flex-col items-center justify-center gap-16 border border-stroke pt-32 pb-8 px-8 rounded-6"
    >
        <code
            class="font-mono text-[1.25rem] text-accent intersect:motion-preset-fade-lg motion-delay-100"
            >{CURRENT_VERSION}</code
        >
        <h1
            class="text-h1 leading-[130%] w-[512px] tracking-tighter text-center intersect:motion-preset-slide-up motion-delay-150 max-[1450px]:text-[64px] max-[750px]:text-[48px]"
        >
            Free & open-source drill writing software
        </h1>
        <p class="text-body intersect:motion-preset-fade-lg motion-delay-250">
            OpenMarch is a free, open-source & intuitive drill writing app for
            the marching arts.
        </p>
        <div
            class="flex flex-wrap gap-8 intersect:motion-preset-fade-lg motion-delay-250"
        >
            <a href="/download">
                <Button>Download</Button>
            </a>
            <a href="/#features">
                <Button variant="secondary">Learn More</Button>
            </a>
        </div>

        <Image
            src={"/home/fullscreen-dark.png"}
            alt="Fullscreen Screenshot"
            width={1920}
            height={1080}
            format="webp"
            quality={80}
            class="hidden dark:block border border-stroke rounded-6 absolute aspect-video h-auto w-[80%] top-[24%] z-20 motion-preset-slide-up-sm motion-delay-300"
        />
        <Image
            src={"/home/fullscreen-light.png"}
            alt="Fullscreen Screenshot"
            width={1920}
            height={1080}
            format="webp"
            quality={80}
            class="block dark:hidden border border-stroke rounded-6 absolute aspect-video h-auto w-[80%] top-[24%] z-20 motion-preset-slide-up-sm motion-delay-300"
        />

        <Image
            src={"/home/editor-dark.png"}
            alt="Editor Screenshot"
            width={1920}
            height={1080}
            format="webp"
            quality={80}
            class="hidden dark:block border border-stroke rounded-6 z-30 mt-[350px] motion-preset-slide-up-sm motion-delay-[400ms]"
        />
        <Image
            src={"/home/editor-light.png"}
            alt="Editor Screenshot"
            width={1920}
            height={1080}
            format="webp"
            quality={80}
            class="block dark:hidden border border-stroke rounded-6 z-30 mt-[350px] motion-preset-slide-up-sm motion-delay-[400ms]"
        />
        <div
            class="absolute top-1/5 left-1/2 -translate-x-1/2 -z-50 size-[29vw] rounded-full bg-accent opacity-40 blur-[20vmin] intersect:motion-preset-fade-lg"
        >
        </div>
    </section>
    <div class="flex justify-center w-full">
        <div
            class="flex flex-col items-center gap-16 rounded-6 border border-stroke bg-fg-1 p-32"
        >
            <h2 class="text-h2">Stay up to date with OpenMarch</h2>
            <NewsletterForm
                client:load
                variant="primary"
                buttonText="Join the Newsletter"
            />
        </div>
    </div>
    <FeatureSelector client:load />
    <section class="flex flex-col gap-72 px-128 max-[1300px]:px-0">
        <div class="flex flex-col gap-24">
            <div
                id="warning"
                class="flex w-full flex-col gap-16 rounded-6 border border-stroke p-24"
            >
                <div class="flex items-center gap-8">
                    <i class="ph ph-warning text-[1.5rem] text-yellow"></i>
                    <h3 class="text-h3">Alpha Software</h3>
                </div>
                <p class="text-body">
                    OpenMarch is still in development. You probably will
                    encounter bugs, issues, and missing features. Help support
                    us grow by contributing or donating!
                </p>
            </div>
            <div class="grid grid-cols-3 gap-24 max-[1000px]:grid-cols-1">
                <div
                    id="download"
                    class="flex flex-col gap-16 rounded-6 border border-accent p-32"
                >
                    <i class="ph ph-download-simple text-[2.5rem] text-accent"
                    ></i>
                    <h2 class="text-h2">Download</h2>
                    <p class="text-body">
                        Try out the modern drill writing app.
                    </p>

                    <a href="/download">
                        <Button variant="primary">Download</Button>
                    </a>
                </div>
                <div
                    id="donate"
                    class="flex flex-col gap-16 rounded-6 border border-accent p-32"
                >
                    <i class="ph ph-patreon-logo text-[2.5rem] text-accent"></i>
                    <h2 class="text-h2">Become a Patron</h2>
                    <p class="text-body">
                        Help us grow, stay free, and support our team! Get
                        access to exclusive content and benefits.
                    </p>
                    <a href="https://www.patreon.com/openmarch">
                        <Button variant="primary">Patreon</Button>
                    </a>
                </div>
                <div
                    id="contribute"
                    class="flex flex-col gap-16 rounded-6 border border-accent p-32"
                >
                    <i class="ph ph-git-fork text-[2.5rem] text-accent"></i>
                    <h2 class="text-h2">Contribute</h2>
                    <p class="text-body">
                        Help us build the modern drill writing app.
                    </p>
                    <div class="flex flex-wrap gap-8">
                        <a href="https://github.com/OpenMarch/OpenMarch">
                            <Button variant="primary">GitHub</Button>
                        </a>
                        <a href="/developers/codebase">
                            <Button variant="secondary">Dev Docs</Button>
                        </a>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-24 max-[920px]:grid-cols-1">
                <div
                    id="community"
                    class="flex w-full flex-col gap-16 rounded-6 border border-stroke p-24"
                >
                    <h2 class="text-h2">Community</h2>
                    <p class="text-body">
                        Make sure to share feedback, get help, and get updates
                        within our Discord & GitHub community.
                    </p>
                    <div class="flex gap-8">
                        <a href="https://discord.gg/eTsQ98uZzq">
                            <Button variant="secondary">Discord</Button>
                        </a>
                        <a href="https://github.com/OpenMarch/OpenMarch">
                            <Button variant="secondary">GitHub</Button>
                        </a>
                    </div>
                </div><div
                    id="community"
                    class="flex w-full flex-col gap-16 rounded-6 border border-stroke p-24"
                >
                    <h2 class="text-h2">Get Started</h2>
                    <p class="text-body">
                        Take a look at our beginner tutorial to get started.
                    </p>
                    <div class="flex gap-8">
                        <a href="/guides/getting-started">
                            <Button variant="secondary">Guides</Button>
                        </a>
                    </div>
                </div>
            </div>
            <div
                id="partners"
                class="flex w-full flex-col items-center justify-center gap-16 rounded-6 border border-stroke p-24"
            >
                <h2 class="text-h2">Partners</h2>
                <div
                    class="grid grid-cols-2 max-[640px]:grid-cols-1 gap-32 justify-center items-center mb-16"
                >
                    <a
                        href="https://silentcommand.org"
                        target="_blank"
                        class="flex justify-center"
                        ><div
                            class="aspect-[328/125] h-auto w-[16rem] max-[640px]:w-[12rem] bg-[url('/partners/sicommandDark.png')] bg-cover dark:bg-[url('/partners/sicommandLight.png')]"
                        >
                        </div></a
                    >
                    <a
                        href="https://corpsclash.com"
                        target="_blank"
                        class="flex items-center justify-center"
                        ><div
                            class="aspect-[328/125] h-[7rem] w-[7rem] max-[640px]:h-[5rem] max-[640px]:w-[5rem] bg-[url('/partners/CorpsClash-dark.svg')] bg-cover bg-center dark:bg-[url('/partners/CorpsClash-light.svg')]"
                        >
                        </div></a
                    >
                </div>
            </div>
        </div>

        <section id="merch">
            <a
                class="grid grid-cols-4"
                href="https://store.openmarch.com"
                target="_blank"
                rel="noreferrer"
            >
                <Image
                    src={"/merch/MerchLaunch-02.png"}
                    alt={"merch photo"}
                    class="h-full w-full rotate-[-.1rad] rounded-6 border-2 border-accent object-cover"
                    width={200}
                    height={400}
                />
                <Image
                    src={"/merch/MerchLaunch-01.png"}
                    alt={"merch photo"}
                    class="col-span-2 row-span-2 h-full w-full rounded-6 border-2 border-accent object-cover"
                    width={200}
                    height={400}
                />
                <Image
                    src={"/merch/MerchLaunch-03.png"}
                    alt={"merch photo"}
                    class="h-full w-full rotate-[.13rad] rounded-6 border-2 border-accent object-cover"
                    width={200}
                    height={400}
                />
                <Image
                    src={"/merch/MerchLaunch-04.png"}
                    alt={"merch photo"}
                    class="h-full w-full rotate-[.13rad] rounded-6 border-2 border-accent object-cover"
                    width={200}
                    height={400}
                />
                <Image
                    src={"/merch/MerchLaunch-05.png"}
                    alt={"merch photo"}
                    class="h-full w-full rotate-[-.13rad] rounded-6 border-2 border-accent object-cover"
                    width={200}
                    height={400}
                />
            </a>
        </section>
        <section id="blogs" class="flex flex-col gap-16">
            <div class="flex justify-between">
                <h1 class="text-h1">Blog</h1><a href="/blog"
                    ><Button>See all posts</Button></a
                >
            </div>
            <div
                class="grid grid-cols-3 gap-24 max-[1200px]:grid-cols-2 max-[850px]:grid-cols-1"
            >
                {
                    blogs
                        .sort(
                            (a, b) =>
                                new Date(b.data.date).getTime() -
                                new Date(a.data.date).getTime(),
                        )
                        .slice(0, 3)
                        .map((blog: Blog) => (
                            <a
                                href={`/blog/${blog.id}`}
                                class="flex flex-col gap-16 rounded-6 border border-stroke bg-fg-1 p-32 duration-150 ease-out hover:border-accent"
                            >
                                <Image
                                    src={blog.data.image}
                                    width={670}
                                    height={420}
                                    alt={blog.data.title}
                                    class="aspect-video h-auto w-full rounded-6 border border-stroke object-cover"
                                />
                                <div class="flex w-full flex-col gap-16">
                                    <h2 class="w-full text-h2">
                                        {blog.data.title}
                                    </h2>
                                    <p class="w-full text-body leading-[150%]">
                                        by {blog.data.author}
                                    </p>
                                    <p class="w-full text-body leading-[150%]">
                                        {blog.data.date.toLocaleDateString(
                                            "en-US",
                                            {
                                                year: "numeric",
                                                month: "long",
                                                day: "numeric",
                                                timeZone: "UTC",
                                            },
                                        )}
                                    </p>
                                </div>
                            </a>
                        ))
                }
            </div>
        </section>
    </section>
</Layout>
